<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclus√£o Anal√≠tica Pro | Gest√£o Estrat√©gica</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Sistema Inclus√£o Anal√≠tica</h1>
            <p>Estrat√©gia e Intelig√™ncia de Dados por <strong>Ana Karolina</strong></p>
        </header>

        <section class="form-card">
            <h3>üìù Novo Registro de Observa√ß√£o</h3>
            
            <div class="input-row">
                <div class="input-group">
                    <label>Identifica√ß√£o do Aluno</label>
                    <input type="text" id="aluno" placeholder="Iniciais ou Nome">
                </div>
                <div class="input-group">
                    <label>Data</label>
                    <input type="date" id="data">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Tipo de Ensino</label>
                    <select id="tipoEnsino">
                        <option value="Anos Iniciais">Anos Iniciais (Infantil)</option>
                        <option value="Fundamental 1">Fundamental 1</option>
                        <option value="Fundamental 2">Fundamental 2</option>
                        <option value="Ensino M√©dio">Ensino M√©dio</option>
                        <option value="EJA">EJA</option>
                        <option value="Superior">Ensino Superior</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Turno</label>
                    <select id="turno">
                        <option value="Manh√£">Manh√£</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Noite">Noite</option>
                        <option value="Integral">Integral</option>
                    </select>
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Turma / Sala (Ex: A, B, C, √önica)</label>
                    <input type="text" id="turma" placeholder="Ex: 4¬∫ Ano B ou Sala 05">
                </div>
                <div class="input-group">
                    <label>Comportamento</label>
                    <select id="comportamento">
                        <option value="Crise">Crise / Desorganiza√ß√£o</option>
                        <option value="Fuga">Fuga da Tarefa</option>
                        <option value="Intera√ß√£o">Intera√ß√£o Social Positiva</option>
                        <option value="Foco">Foco na Atividade</option>
                    </select>
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Frequ√™ncia (Ocorr√™ncias)</label>
                    <input type="number" id="frequencia" placeholder="Ex: 1">
                </div>
                <div class="input-group">
                    <label>Professor / Respons√°vel</label>
                    <input type="text" id="professor" placeholder="Nome do Professor ou M√£e">
                </div>
            </div>

            <button class="btn-primary" onclick="adicionarDado()">Registrar no Banco de Dados</button>
        </section>

        <section class="chart-card">
            <div class="filter-header">
                <h3>üìà Dashboard Anal√≠tico</h3>
                <div class="filters-container">
                    <div class="filter-box">
                        <label>Filtrar Visualiza√ß√£o por:</label>
                        <select id="tipoFiltro" onchange="atualizarOpcoesFiltro()">
                            <option value="aluno">Por Aluno</option>
                            <option value="turma">Por Turma / Sala</option>
                            <option value="tipoEnsino">Por Tipo de Ensino</option>
                            <option value="turno">Por Turno</option>
                        </select>
                    </div>
                    <div class="filter-box">
                        <label>Selecionar Espec√≠fico:</label>
                        <select id="valorFiltro" onchange="renderizarGrafico()">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>
            </div>
            <canvas id="graficoEvolucao"></canvas>
        </section>

        <section class="actions">
            <button class="btn-export" onclick="exportarCSV()">üì• Exportar Dados (CSV/Excel)</button>
            <button class="btn-clear" onclick="limparDados()">‚ö†Ô∏è Reiniciar Hist√≥rico</button>
        </section>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('dadosInclusao')) || [];
        let meuGrafico;

        function adicionarDado() {
            const aluno = document.getElementById('aluno').value.toUpperCase().trim();
            const data = document.getElementById('data').value;
            const tipoEnsino = document.getElementById('tipoEnsino').value;
            const turno = document.getElementById('turno').value;
            const turma = document.getElementById('turma').value.toUpperCase().trim();
            const comportamento = document.getElementById('comportamento').value;
            const frequencia = document.getElementById('frequencia').value;
            const professor = document.getElementById('professor').value;

            if(!aluno || !data || !frequencia) return alert("Preencha Aluno, Data e Frequ√™ncia!");

            db.push({ aluno, data, tipoEnsino, turno, turma, comportamento, frequencia: parseInt(frequencia), professor });
            localStorage.setItem('dadosInclusao', JSON.stringify(db));
            
            alert("Sucesso! Registro armazenado.");
            atualizarOpcoesFiltro();
            document.getElementById('frequencia').value = '';
        }

        function atualizarOpcoesFiltro() {
            const tipo = document.getElementById('tipoFiltro').value;
            const selectValor = document.getElementById('valorFiltro');
            const itensUnicos = [...new Set(db.map(d => d[tipo]))];

            selectValor.innerHTML = '<option value="">Selecione...</option>';
            itensUnicos.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item;
                opt.textContent = item;
                selectValor.appendChild(opt);
            });
        }

        function renderizarGrafico() {
            const ctx = document.getElementById('graficoEvolucao').getContext('2d');
            if (meuGrafico) meuGrafico.destroy();

            const tipo = document.getElementById('tipoFiltro').value;
            const valor = document.getElementById('valorFiltro').value;
            if(!valor) return;

            let dadosFiltrados = db.filter(d => d[tipo] === valor);
            
            // Agrupar por data (Soma das frequ√™ncias por dia)
            const dadosAgrupados = dadosFiltrados.reduce((acc, curr) => {
                acc[curr.data] = (acc[curr.data] || 0) + curr.frequencia;
                return acc;
            }, {});

            const labels = Object.keys(dadosAgrupados).sort();
            const valores = labels.map(l => dadosAgrupados[l]);

            meuGrafico = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Frequ√™ncia Acumulada: ${valor}`,
                        data: valores,
                        borderColor: '#2980b9',
                        backgroundColor: 'rgba(41, 128, 185, 0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });
        }

        function exportarCSV() {
            if(db.length === 0) return alert("N√£o h√° dados.");
            let csv = "\uFEFFAluno;Data;Ensino;Turno;Turma_Sala;Comportamento;Frequencia;Responsavel\n";
            db.forEach(d => {
                csv += `${d.aluno};${d.data};${d.tipoEnsino};${d.turno};${d.turma};${d.comportamento};${d.frequencia};${d.professor}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "relatorio_analitico_ana_karolina.csv";
            link.click();
        }

        function limparDados() {
            if(confirm("Deseja apagar todos os dados registrados?")) {
                localStorage.removeItem('dadosInclusao');
                db = [];
                atualizarOpcoesFiltro();
                if(meuGrafico) meuGrafico.destroy();
            }
        }
        
        atualizarOpcoesFiltro();
    </script>
</body>
</html>