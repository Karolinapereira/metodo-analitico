<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclus√£o Anal√≠tica Pro | Legal & Data Intelligence</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Sistema Inclus√£o Anal√≠tica</h1>
            <p>Intelig√™ncia de Dados e Compliance Jur√≠dico por <strong>Ana Karolina</strong></p>
        </header>

        <section id="legalCard" class="legal-card" style="display: none;">
            <h3>‚öñÔ∏è Parecer T√©cnico-Jur√≠dico Autom√°tico</h3>
            <p id="legalTexto">Selecione um filtro para gerar a fundamenta√ß√£o legal.</p>
            <small>*Este output baseia-se na LBI (Lei 13.146/15) e normas do CNE.</small>
        </section>

        <section class="form-card">
            <h3>üìù Registro de Evid√™ncias</h3>
            <div class="input-row">
                <div class="input-group">
                    <label>Identifica√ß√£o do Aluno (Iniciais)</label>
                    <input type="text" id="aluno" placeholder="Ex: A.B.C.">
                </div>
                <div class="input-group">
                    <label>Data da Ocorr√™ncia</label>
                    <input type="date" id="data">
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Tipo de Ensino</label>
                    <select id="tipoEnsino">
                        <option value="Anos Iniciais">Anos Iniciais</option>
                        <option value="Fundamental 1">Fundamental 1</option>
                        <option value="Fundamental 2">Fundamental 2</option>
                        <option value="Ensino M√©dio">Ensino M√©dio</option>
                        <option value="EJA">EJA</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Turno</label>
                    <select id="turno">
                        <option value="Manh√£">Manh√£</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Integral">Integral</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Turma/Sala</label>
                    <input type="text" id="turma" placeholder="Ex: 5¬∫ Ano C">
                </div>
                <div class="input-group">
                    <label>Intensidade (1 a 5)</label>
                    <select id="intensidade">
                        <option value="1">1 - M√≠nima</option>
                        <option value="3">3 - Moderada</option>
                        <option value="5">5 - Cr√≠tica (Risco Legal)</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Comportamento</label>
                    <select id="comportamento">
                        <option value="Crise">Crise / Desorganiza√ß√£o</option>
                        <option value="Fuga">Fuga da Tarefa (Recusa escolar)</option>
                        <option value="Intera√ß√£o">Intera√ß√£o Social Positiva</option>
                        <option value="Engajamento">Engajamento Pedag√≥gico</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Frequ√™ncia</label>
                    <input type="number" id="frequencia" placeholder="Qtd">
                </div>
            </div>
            <button class="btn-primary" onclick="adicionarDado()">Registrar Evid√™ncia</button>
        </section>

        <section class="chart-card">
            <div class="filter-header">
                <h3>üìà An√°lise de Indicadores e PDI</h3>
                <div class="filters-container">
                    <div class="filter-box">
                        <label>Analisar por:</label>
                        <select id="tipoFiltro" onchange="atualizarOpcoesFiltro()">
                            <option value="aluno">Aluno</option>
                            <option value="turma">Turma</option>
                        </select>
                    </div>
                    <div class="filter-box">
                        <label>Selecionar:</label>
                        <select id="valorFiltro" onchange="renderizarGrafico()">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                </div>
            </div>
            <canvas id="graficoEvolucao"></canvas>
        </section>

        <section class="actions">
            <button class="btn-export" onclick="exportarCSV()">üì• Baixar Relat√≥rio Probat√≥rio</button>
            <button class="btn-clear" onclick="limparDados()">‚ö†Ô∏è Limpar Sistema</button>
        </section>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('dadosInclusao')) || [];
        let meuGrafico;

        function adicionarDado() {
            const aluno = document.getElementById('aluno').value.toUpperCase().trim();
            const data = document.getElementById('data').value;
            const frequencia = parseInt(document.getElementById('frequencia').value);
            const intensidade = parseInt(document.getElementById('intensidade').value);
            
            if(!aluno || !data || isNaN(frequencia)) return alert("Campos obrigat√≥rios: Aluno, Data e Frequ√™ncia.");

            db.push({
                aluno, data, 
                tipoEnsino: document.getElementById('tipoEnsino').value,
                turno: document.getElementById('turno').value,
                turma: document.getElementById('turma').value.toUpperCase().trim(),
                comportamento: document.getElementById('comportamento').value,
                frequencia, intensidade
            });
            
            localStorage.setItem('dadosInclusao', JSON.stringify(db));
            alert("Evid√™ncia registrada com sucesso!");
            atualizarOpcoesFiltro();
        }

        function gerarParecerJuridico(dados) {
            const mediaInt = (dados.reduce((acc, d) => acc + d.intensidade, 0) / dados.length).toFixed(1);
            const crises = dados.filter(d => d.comportamento === "Crise").length;
            
            let parecer = `<strong>An√°lise de Conformidade:</strong> Para o aluno/turma selecionado, foram identificadas ${crises} ocorr√™ncias cr√≠ticas. <br><br>`;
            
            if(mediaInt >= 4) {
                parecer += `üî¥ <strong>ALERTA DE RISCO JUR√çDICO:</strong> A intensidade m√©dia das ocorr√™ncias exige revis√£o imediata do PDI (Plano de Desenvolvimento Individualizado), conforme a <strong>Lei 13.146/15 (Art. 28)</strong>. A aus√™ncia de ajustes pode caracterizar omiss√£o de atendimento especializado.`;
            } else if (crises > 5) {
                parecer += `üü° <strong>RECOMENDA√á√ÉO:</strong> O volume de ocorr√™ncias sugere a necessidade de refor√ßo no AEE (Atendimento Educacional Especializado), em observ√¢ncia ao <strong>Decreto 7.611/11</strong>.`;
            } else {
                parecer += `üü¢ <strong>SITUA√á√ÉO REGULAR:</strong> Os registros demonstram monitoramento cont√≠nuo, servindo como lastro probat√≥rio de que a escola est√° promovendo as adapta√ß√µes razo√°veis exigidas pela legisla√ß√£o vigente.`;
            }
            return parecer;
        }

        function atualizarOpcoesFiltro() {
            const tipo = document.getElementById('tipoFiltro').value;
            const selectValor = document.getElementById('valorFiltro');
            const itensUnicos = [...new Set(db.map(d => d[tipo]))];
            selectValor.innerHTML = '<option value="">Selecione...</option>';
            itensUnicos.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item; opt.textContent = item;
                selectValor.appendChild(opt);
            });
        }

        function renderizarGrafico() {
            const ctx = document.getElementById('graficoEvolucao').getContext('2d');
            const valor = document.getElementById('valorFiltro').value;
            const tipo = document.getElementById('tipoFiltro').value;
            if(!valor) return;

            const dadosF = db.filter(d => d[tipo] === valor).sort((a, b) => new Date(a.data) - new Date(b.data));
            
            document.getElementById('legalCard').style.display = 'block';
            document.getElementById('legalTexto').innerHTML = gerarParecerJuridico(dadosF);

            if (meuGrafico) meuGrafico.destroy();
            meuGrafico = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dadosF.map(d => d.data),
                    datasets: [
                        { label: 'Frequ√™ncia', data: dadosF.map(d => d.frequencia), borderColor: '#3498db', backgroundColor: 'rgba(52, 152, 219, 0.1)', fill: true },
                        { label: 'Intensidade (Risco)', data: dadosF.map(d => d.intensidade), borderColor: '#e74c3c', borderDash: [5, 5], fill: false }
                    ]
                }
            });
        }

        function exportarCSV() {
            let csv = "\uFEFFAluno;Data;Ensino;Turno;Turma;Comportamento;Frequencia;Intensidade\n";
            db.forEach(d => { csv += `${d.aluno};${d.data};${d.tipoEnsino};${d.turno};${d.turma};${d.comportamento};${d.frequencia};${d.intensidade}\n`; });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "evidencia_juridica_inclusao.csv";
            link.click();
        }

        function limparDados() {
            if(confirm("Deseja apagar os registros?")) { localStorage.removeItem('dadosInclusao'); location.reload(); }
        }
        atualizarOpcoesFiltro();
    </script>
</body>
</html>