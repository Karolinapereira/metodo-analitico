<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclus√£o Anal√≠tica Pro | Auditoria Jur√≠dico-Pedag√≥gica</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Sistema Inclus√£o Anal√≠tica</h1>
            <p>Compliance Jur√≠dico e Intelig√™ncia de Dados | <strong>Ana Karolina</strong></p>
        </header>

        <section id="legalCard" class="legal-card" style="display: none;">
            <h3>‚öñÔ∏è Diagn√≥stico de Conformidade Legal (Output de Direito)</h3>
            <div id="legalTexto">Selecione um filtro para gerar o parecer t√©cnico.</div>
        </section>

        <section class="form-card">
            <h3>üè´ Contexto da Unidade e Suporte</h3>
            <div class="input-row">
                <div class="input-group">
                    <label>Total de Alunos na Turma</label>
                    <input type="number" id="totalAlunos" placeholder="Ex: 25">
                </div>
                <div class="input-group">
                    <label>Alunos PCD na Sala</label>
                    <input type="number" id="totalPCD" placeholder="Ex: 3">
                </div>
                <div class="input-group">
                    <label>Turno</label>
                    <select id="turno">
                        <option value="Manh√£">Manh√£</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Integral">Integral</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Profissional de Apoio (Lei 13.146)</label>
                    <select id="temApoio">
                        <option value="Sim">Sim (Exclusivo)</option>
                        <option value="Compartilhado">Compartilhado</option>
                        <option value="N√£o">N√£o (D√©ficit de Direito)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Acompanhamento por AT (ABA)</label>
                    <select id="temAT">
                        <option value="Sim">Sim</option>
                        <option value="N√£o">N√£o</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="form-card">
            <h3>üìù Registro de Evid√™ncia e Pr√°tica Pedag√≥gica</h3>
            <div class="input-row">
                <div class="input-group">
                    <label>Iniciais do Aluno</label>
                    <input type="text" id="aluno" placeholder="Ex: A.K.P.">
                </div>
                <div class="input-group">
                    <label>Data</label>
                    <input type="date" id="data">
                </div>
                <div class="input-group">
                    <label>Adapta√ß√£o Curricular (PDI)</label>
                    <select id="adaptacao">
                        <option value="Sim">Sim (Integral)</option>
                        <option value="Parcial">Parcial (Simplificada)</option>
                        <option value="N√£o">N√£o (Risco de Exclus√£o)</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Comportamento/Ocorr√™ncia</label>
                    <select id="comportamento">
                        <option value="Crise">Crise / Desorganiza√ß√£o</option>
                        <option value="Fuga">Fuga da Tarefa / Recusa</option>
                        <option value="Intera√ß√£o">Intera√ß√£o Social Positiva</option>
                        <option value="Autonomia">Ganho de Autonomia</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Frequ√™ncia</label>
                    <input type="number" id="frequencia" placeholder="Qtd">
                </div>
                <div class="input-group">
                    <label>Intensidade (1 a 5)</label>
                    <input type="number" id="intensidade" min="1" max="5" placeholder="1-5">
                </div>
            </div>
            <button class="btn-primary" onclick="adicionarDado()">Registrar e Auditar</button>
        </section>

        <section class="chart-card">
            <div class="filter-header">
                <h3>üìà Dashboard Anal√≠tico</h3>
                <div class="filters-container">
                    <select id="tipoFiltro" onchange="atualizarOpcoesFiltro()">
                        <option value="aluno">Por Aluno</option>
                        <option value="turno">Por Turno</option>
                    </select>
                    <select id="valorFiltro" onchange="renderizarGrafico()">
                        <option value="">Selecione...</option>
                    </select>
                </div>
            </div>
            <canvas id="graficoEvolucao"></canvas>
        </section>

        <section class="actions">
            <button class="btn-export" onclick="exportarCSV()">üì• Gerar Dossi√™ de Inclus√£o (Excel)</button>
            <button class="btn-clear" onclick="limparDados()">‚ö†Ô∏è Reiniciar Sistema</button>
        </section>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('dadosInclusao')) || [];
        let meuGrafico;

        function adicionarDado() {
            const entry = {
                aluno: document.getElementById('aluno').value.toUpperCase().trim(),
                data: document.getElementById('data').value,
                totalAlunos: document.getElementById('totalAlunos').value,
                totalPCD: document.getElementById('totalPCD').value,
                turno: document.getElementById('turno').value,
                temApoio: document.getElementById('temApoio').value,
                temAT: document.getElementById('temAT').value,
                adaptacao: document.getElementById('adaptacao').value,
                comportamento: document.getElementById('comportamento').value,
                frequencia: parseInt(document.getElementById('frequencia').value) || 0,
                intensidade: parseInt(document.getElementById('intensidade').value) || 1
            };

            if(!entry.aluno || !entry.data) return alert("Aluno e Data s√£o obrigat√≥rios.");
            db.push(entry);
            localStorage.setItem('dadosInclusao', JSON.stringify(db));
            alert("Evid√™ncia registrada!");
            atualizarOpcoesFiltro();
        }

        function atualizarOpcoesFiltro() {
            const tipo = document.getElementById('tipoFiltro').value;
            const select = document.getElementById('valorFiltro');
            const itens = [...new Set(db.map(d => d[tipo]))];
            select.innerHTML = '<option value="">Selecione...</option>';
            itens.forEach(i => { const opt = document.createElement('option'); opt.value = i; opt.textContent = i; select.appendChild(opt); });
        }

        function analisarJuridicamente(dados) {
            const ultimo = dados[dados.length - 1];
            let parecer = "";
            
            if(ultimo.temApoio === "N√£o") parecer += "üî¥ <strong>VIOLA√á√ÉO DE DIREITO:</strong> Aus√™ncia de Profissional de Apoio (Art. 28, XVII, LBI). <br>";
            if(ultimo.adaptacao === "N√£o") parecer += "üî¥ <strong>RISCO LEGAL:</strong> Inexist√™ncia de adapta√ß√£o curricular (Art. 28, II, LBI). <br>";
            if(parseInt(ultimo.totalPCD) > 3) parecer += "‚ö†Ô∏è <strong>ALERTA GEST√ÉO:</strong> Alta densidade de alunos PCD na mesma turma. <br>";
            
            if(parecer === "") parecer = "‚úÖ <strong>CONFORMIDADE LEGAL:</strong> Inclus√£o amparada por recursos de apoio e adapta√ß√£o.";
            
            document.getElementById('legalCard').style.display = 'block';
            document.getElementById('legalTexto').innerHTML = parecer;
        }

        function renderizarGrafico() {
            const tipo = document.getElementById('tipoFiltro').value;
            const valor = document.getElementById('valorFiltro').value;
            if(!valor) return;

            const dadosF = db.filter(d => d[tipo] === valor).sort((a,b) => new Date(a.data) - new Date(b.data));
            analisarJuridicamente(dadosF);

            const ctx = document.getElementById('graficoEvolucao').getContext('2d');
            if (meuGrafico) meuGrafico.destroy();
            meuGrafico = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dadosF.map(d => d.data),
                    datasets: [
                        { label: 'Frequ√™ncia', data: dadosF.map(d => d.frequencia), borderColor: '#3498db', fill: false },
                        { label: 'Intensidade', data: dadosF.map(d => d.intensidade), borderColor: '#e74c3c', borderDash: [5,5] }
                    ]
                }
            });
        }

        function exportarCSV() {
            let csv = "\uFEFFAluno;Data;AlunosTotal;PCDTotal;Turno;Apoio;AT;Adaptacao;Comportamento;Frequencia;Intensidade\n";
            db.forEach(d => { csv += `${d.aluno};${d.data};${d.totalAlunos};${d.totalPCD};${d.turno};${d.temApoio};${d.temAT};${d.adaptacao};${d.comportamento};${d.frequencia};${d.intensidade}\n`; });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
            link.download = "dossie_inclusao_analitica.csv";
            link.click();
        }

        function limparDados() { if(confirm("Apagar tudo?")) { localStorage.clear(); location.reload(); } }
        atualizarOpcoesFiltro();
    </script>
</body>
</html>