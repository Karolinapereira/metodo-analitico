<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclus√£o Anal√≠tica Pro | Gest√£o Nacional e Auditoria</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Sistema Inclus√£o Anal√≠tica</h1>
            <p>Auditoria Estrat√©gica e Intelig√™ncia de Rede | <strong>Ana Karolina</strong></p>
        </header>

        <section id="legalCard" class="legal-card" style="display: none;">
            <h3>‚öñÔ∏è Parecer T√©cnico de Auditoria (Fato e Direito)</h3>
            <div id="legalTexto"></div>
            <small>*Baseado na LBI (13.146/15), PNEE e diretrizes do FUNDEB.</small>
        </section>

        <section class="form-card">
            <h3>üè¢ Configura√ß√£o do Suporte e Rede</h3>
            <div class="input-row">
                <div class="input-group">
                    <label>P√∫blico-Alvo (PNEE/Defici√™ncia)</label>
                    <select id="tipoDeficiencia">
                        <option value="TEA">TEA (Transtorno do Espectro Autista)</option>
                        <option value="DI">Defici√™ncia Intelectual</option>
                        <option value="DV/DA">Defici√™ncia Sensorial (Visual/Auditiva)</option>
                        <option value="DF">Defici√™ncia F√≠sica / Motora</option>
                        <option value="AH/SD">Altas Habilidades / Superdota√ß√£o</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Frequenta AEE? (Matr√≠cula Dupla FUNDEB)</label>
                    <select id="frequentaAEE">
                        <option value="Sim">Sim (Em conformidade)</option>
                        <option value="N√£o">N√£o (D√©ficit de Atendimento/Recurso)</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Profissional de Apoio (Lei 13.146)</label>
                    <select id="temApoio">
                        <option value="Exclusivo">Exclusivo (1:1)</option>
                        <option value="Compartilhado">Compartilhado (Turma)</option>
                        <option value="Ausente">Ausente (Gargalo Jur√≠dico)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Rotatividade de Apoio (Trocas no ano)</label>
                    <input type="number" id="rotatividade" placeholder="Qtd de profissionais">
                </div>
            </div>
        </section>

        <section class="form-card">
            <h3>üìù Evid√™ncia de Campo (PDI)</h3>
            <div class="input-row">
                <div class="input-group">
                    <label>Identifica√ß√£o (Iniciais)</label>
                    <input type="text" id="aluno" placeholder="Ex: A.K.P.">
                </div>
                <div class="input-group">
                    <label>Data</label>
                    <input type="date" id="data">
                </div>
                <div class="input-group">
                    <label>Adapta√ß√£o Curricular Realizada?</label>
                    <select id="adaptacao">
                        <option value="Sim">Sim (Material Adaptado)</option>
                        <option value="Parcial">Parcial (Adapta√ß√£o de Pequeno Porte)</option>
                        <option value="N√£o">N√£o (Risco de Exclus√£o)</option>
                    </select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Ocorr√™ncia</label>
                    <select id="comportamento">
                        <option value="Crise">Crise / Desorganiza√ß√£o</option>
                        <option value="Fuga">Fuga da Tarefa / Recusa</option>
                        <option value="Autonomia">Ganho de Autonomia</option>
                        <option value="Interacao">Intera√ß√£o Social Positiva</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Frequ√™ncia</label>
                    <input type="number" id="frequencia">
                </div>
                <div class="input-group">
                    <label>Intensidade (Escala 1 a 5)</label>
                    <input type="number" id="intensidade" min="1" max="5">
                </div>
            </div>
            <button class="btn-primary" onclick="adicionarDado()">Registrar e Auditar Impacto</button>
        </section>

        <section class="chart-card">
            <div class="filter-header">
                <h3>üìà Dashboard de Auditoria Nacional</h3>
                <div class="filters-container">
                    <select id="tipoFiltro" onchange="atualizarOpcoesFiltro()">
                        <option value="aluno">Por Aluno</option>
                        <option value="tipoDeficiencia">Por Tipo de Defici√™ncia</option>
                        <option value="frequentaAEE">Por Status AEE</option>
                    </select>
                    <select id="valorFiltro" onchange="renderizarGrafico()">
                        <option value="">Selecione para analisar...</option>
                    </select>
                </div>
            </div>
            <canvas id="graficoEvolucao"></canvas>
        </section>

        <section class="actions">
            <button class="btn-export" onclick="exportarCSV()">üì• Gerar Dossi√™ Probat√≥rio (CSV)</button>
            <button class="btn-clear" onclick="limparDados()">‚ö†Ô∏è Reiniciar Banco de Dados</button>
        </section>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('dadosInclusao')) || [];
        let meuGrafico;

        function adicionarDado() {
            const entry = {
                aluno: document.getElementById('aluno').value.toUpperCase().trim(),
                data: document.getElementById('data').value,
                tipoDeficiencia: document.getElementById('tipoDeficiencia').value,
                frequentaAEE: document.getElementById('frequentaAEE').value,
                temApoio: document.getElementById('temApoio').value,
                rotatividade: parseInt(document.getElementById('rotatividade').value) || 0,
                adaptacao: document.getElementById('adaptacao').value,
                comportamento: document.getElementById('comportamento').value,
                frequencia: parseInt(document.getElementById('frequencia').value) || 0,
                intensidade: parseInt(document.getElementById('intensidade').value) || 1
            };

            if(!entry.aluno || !entry.data) return alert("Campos obrigat√≥rios: Aluno e Data.");
            db.push(entry);
            localStorage.setItem('dadosInclusao', JSON.stringify(db));
            alert("Evid√™ncia registrada para o Dossi√™.");
            atualizarOpcoesFiltro();
        }

        function analisarJuridicamente(dados) {
            const ultimo = dados[dados.length - 1];
            let parecer = "";
            
            if(ultimo.frequentaAEE === "N√£o") parecer += "üî¥ <strong>ALERTA DE GEST√ÉO:</strong> Aluno fora do AEE. Risco de perda de financiamento (FUNDEB) e descumprimento do Decreto 7.611/11.<br>";
            if(ultimo.temApoio === "Ausente") parecer += "üî¥ <strong>RISCO JUR√çDICO ALTO:</strong> Aus√™ncia de Profissional de Apoio configura falha na presta√ß√£o do servi√ßo (Art. 28 LBI).<br>";
            if(ultimo.rotatividade > 2) parecer += "‚ö†Ô∏è <strong>ALERTA DE INSTABILIDADE:</strong> Alta rotatividade de profissionais prejudica o desenvolvimento do PDI.<br>";
            if(ultimo.adaptacao === "N√£o") parecer += "üî¥ <strong>EXCLUS√ÉO PEDAG√ìGICA:</strong> Falta de adapta√ß√£o curricular fere o direito ao aprendizado efetivo.<br>";
            
            if(parecer === "") parecer = "‚úÖ <strong>CONFORMIDADE:</strong> Os indicadores sugerem atendimento pleno aos requisitos da Lei 13.146/15.";
            
            document.getElementById('legalCard').style.display = 'block';
            document.getElementById('legalTexto').innerHTML = parecer;
        }

        function atualizarOpcoesFiltro() {
            const tipo = document.getElementById('tipoFiltro').value;
            const select = document.getElementById('valorFiltro');
            const itens = [...new Set(db.map(d => d[tipo]))];
            select.innerHTML = '<option value="">Selecione...</option>';
            itens.forEach(i => { const opt = document.createElement('option'); opt.value = i; opt.textContent = i; select.appendChild(opt); });
        }

        function renderizarGrafico() {
            const tipo = document.getElementById('tipoFiltro').value;
            const valor = document.getElementById('valorFiltro').value;
            if(!valor) return;
            const dadosF = db.filter(d => d[tipo] === valor).sort((a,b) => new Date(a.data) - new Date(b.data));
            analisarJuridicamente(dadosF);
            const ctx = document.getElementById('graficoEvolucao').getContext('2d');
            if (meuGrafico) meuGrafico.destroy();
            meuGrafico = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dadosF.map(d => d.data),
                    datasets: [
                        { label: 'Frequ√™ncia', data: dadosF.map(d => d.frequencia), borderColor: '#3498db', fill: false },
                        { label: 'Intensidade', data: dadosF.map(d => d.intensidade), borderColor: '#e74c3c', borderDash: [5,5] }
                    ]
                }
            });
        }

        function exportarCSV() {
            let csv = "\uFEFFAluno;Data;Deficiencia;AEE;Apoio;Rotatividade;Adaptacao;Comportamento;Frequencia;Intensidade\n";
            db.forEach(d => { csv += `${d.aluno};${d.data};${d.tipoDeficiencia};${d.frequentaAEE};${d.temApoio};${d.rotatividade};${d.adaptacao};${d.comportamento};${d.frequencia};${d.intensidade}\n`; });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "dossie_auditoria_inclusao.csv";
            link.click();
        }

        function limparDados() { if(confirm("Deseja apagar o banco de dados?")) { localStorage.clear(); location.reload(); } }
        atualizarOpcoesFiltro();
    </script>
</body>
</html>