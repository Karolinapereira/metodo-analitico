<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inclus√£o Anal√≠tica Pro | Ana Karolina</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Sistema Inclus√£o Anal√≠tica</h1>
            <p>Estrat√©gia e Dados por <strong>Ana Karolina</strong></p>
        </header>

        <section class="form-card">
            <h3>üìù Registro de Observa√ß√£o</h3>
            
            <div class="input-row">
                <div class="input-group">
                    <label>Identifica√ß√£o do Aluno (Iniciais)</label>
                    <input type="text" id="aluno" placeholder="Ex: A.S.P.">
                </div>
                <div class="input-group">
                    <label>Data</label>
                    <input type="date" id="data">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Professor Regente / Respons√°vel</label>
                    <input type="text" id="professor" placeholder="Nome do Professor ou M√£e/Pai">
                </div>
                <div class="input-group">
                    <label>Turma / Ano / Local</label>
                    <input type="text" id="turma" placeholder="Ex: 3¬∫ Ano B ou 'Casa'">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Comportamento Alvo</label>
                    <select id="comportamento">
                        <option value="Crise">Crise / Desorganiza√ß√£o</option>
                        <option value="Fuga">Fuga da Tarefa</option>
                        <option value="Interacao">Intera√ß√£o Social Positiva</option>
                        <option value="Foco">Foco na Atividade</option>
                        <option value="Estereotipia">Estereotipia</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Frequ√™ncia (Ocorr√™ncias)</label>
                    <input type="number" id="frequencia" placeholder="Ex: 3">
                </div>
            </div>

            <button class="btn-primary" onclick="adicionarDado()">Registrar no Sistema</button>
        </section>

        <section class="chart-card">
            <div class="chart-header">
                <h3>üìà Evolu√ß√£o por Aluno</h3>
                <select id="filtroAluno" onchange="renderizarGrafico()">
                    <option value="">Selecione para ver o gr√°fico</option>
                </select>
            </div>
            <div id="infoContexto" class="info-contexto"></div>
            <canvas id="graficoEvolucao"></canvas>
        </section>

        <section class="actions">
            <button class="btn-export" onclick="exportarCSV()">üì• Exportar Relat√≥rio CSV</button>
            <button class="btn-clear" onclick="limparDados()">‚ö†Ô∏è Limpar Tudo</button>
        </section>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('dadosInclusao')) || [];
        const ctx = document.getElementById('graficoEvolucao').getContext('2d');
        let meuGrafico;

        function atualizarFiltroAlunos() {
            const select = document.getElementById('filtroAluno');
            const alunosUnicos = [...new Set(db.map(d => d.aluno))];
            select.innerHTML = '<option value="">Selecione o Aluno</option>';
            alunosUnicos.forEach(aluno => {
                const opt = document.createElement('option');
                opt.value = aluno;
                opt.textContent = aluno;
                select.appendChild(opt);
            });
        }

        function adicionarDado() {
            const aluno = document.getElementById('aluno').value.toUpperCase();
            const data = document.getElementById('data').value;
            const frequencia = document.getElementById('frequencia').value;
            const professor = document.getElementById('professor').value || "N√£o informado";
            const turma = document.getElementById('turma').value || "N√£o informado";
            const comportamento = document.getElementById('comportamento').value;
            
            if(!aluno || !data || !frequencia) return alert("Preencha Aluno, Data e Frequ√™ncia!");

            db.push({ aluno, x: data, y: parseInt(frequencia), professor, turma, tipo: comportamento });
            localStorage.setItem('dadosInclusao', JSON.stringify(db));
            
            atualizarFiltroAlunos();
            alert("Registrado com sucesso!");
            document.getElementById('frequencia').value = '';
        }

        function renderizarGrafico() {
            if (meuGrafico) meuGrafico.destroy();
            const alunoSel = document.getElementById('filtroAluno').value;
            const infoDiv = document.getElementById('infoContexto');
            
            if(!alunoSel) { infoDiv.innerHTML = ""; return; }

            const dadosF = db.filter(d => d.aluno === alunoSel).sort((a, b) => new Date(a.x) - new Date(b.x));
            
            // Mostrar contexto do √∫ltimo registro
            const ultimo = dadosF[dadosF.length - 1];
            infoDiv.innerHTML = `<strong>Contexto:</strong> ${ultimo.tur